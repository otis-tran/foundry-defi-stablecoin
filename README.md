# ğŸ“š Decentralized Finance (DeFi)
> TÃ i liá»‡u tham kháº£o: [Decentralized Finance (DeFi) - Cyfrin](https://www.cyfrin.io/glossary/decentralized-finance-defi)

---

## ğŸ’¡ Giá»›i thiá»‡u

**DeFi (TÃ i chÃ­nh phi táº­p trung)** lÃ  cÃ¡c dá»‹ch vá»¥ vÃ  sáº£n pháº©m tÃ i chÃ­nh Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn ná»n táº£ng blockchain, chá»§ yáº¿u sá»­ dá»¥ng **smart contracts**.

CÃ¡c dá»‹ch vá»¥ nÃ y **khÃ´ng cáº§n trung gian tÃ i chÃ­nh** nhÆ° ngÃ¢n hÃ ng hay mÃ´i giá»›i, cho phÃ©p ngÆ°á»i dÃ¹ng **giao dá»‹ch trá»±c tiáº¿p (peer-to-peer)**.  
DeFi **tá»± Ä‘á»™ng hÃ³a hoáº¡t Ä‘á»™ng tÃ i chÃ­nh báº±ng code**, giÃºp ngÆ°á»i dÃ¹ng **giao dá»‹ch, cho vay, Ä‘i vay, Ä‘áº§u tÆ°** mÃ  khÃ´ng cáº§n Ä‘áº¿n tá»• chá»©c quáº£n lÃ½ táº­p trung.

---

## ğŸ§¬ Äáº·c Ä‘iá»ƒm ná»•i báº­t cá»§a DeFi

### âœ… Truy cáº­p khÃ´ng cáº§n cáº¥p phÃ©p (*Permissionless Access*)

- KhÃ´ng tá»• chá»©c nÃ o kiá»ƒm soÃ¡t quyá»n truy cáº­p.
- Báº¥t ká»³ ai cÃ³ vÃ­ crypto Ä‘á»u cÃ³ thá»ƒ tham gia â€“ **khÃ´ng giá»›i háº¡n vá»‹ trÃ­, tÃ i sáº£n, hay giáº¥y phÃ©p**.
- Truy cáº­p 24/7 toÃ n cáº§u, ngÆ°á»i dÃ¹ng **tá»± giá»¯ tÃ i sáº£n (self-custody)**.
- Báº¥t ká»³ ai cÅ©ng cÃ³ thá»ƒ xÃ¢y dá»±ng vÃ  triá»ƒn khai giao thá»©c DeFi â†’ **khuyáº¿n khÃ­ch Ä‘á»•i má»›i vÃ  phÃ¡t triá»ƒn há»‡ sinh thÃ¡i**.

---

### ğŸ” Minh báº¡ch (*Transparency*)

- Táº¥t cáº£ giao dá»‹ch **hiá»ƒn thá»‹ cÃ´ng khai trÃªn chuá»—i (on-chain)**.
- MÃ£ smart contract **cÃ³ thá»ƒ kiá»ƒm tra cÃ´ng khai**.
- Quy táº¯c giao thá»©c Ä‘Æ°á»£c mÃ£ hÃ³a â†’ **ai cÅ©ng cÃ³ thá»ƒ xem xÃ©t vÃ  xÃ¡c minh**.

---

### ğŸ§© Kháº£ nÄƒng káº¿t há»£p (*Composability*)

- CÃ¡c giao thá»©c DeFi cÃ³ thá»ƒ **tÆ°Æ¡ng tÃ¡c vÃ  xÃ¢y dá»±ng trÃªn nhau**.
- Cho phÃ©p:
    - **NgÆ°á»i dÃ¹ng** káº¿t há»£p nhiá»u giao thá»©c trong má»™t giao dá»‹ch.
    - **Developer** táº¡o á»©ng dá»¥ng má»›i báº±ng cÃ¡ch **tÃ¡i sá»­ dá»¥ng cÃ¡c giao thá»©c cÃ³ sáºµn nhÆ° Lego**.

---

---

## âš™ï¸ Core Components (CÃ¡c thÃ nh pháº§n cá»‘t lÃµi)

### ğŸ“œ Smart Contracts

Smart contracts lÃ  cÃ¡c chÆ°Æ¡ng trÃ¬nh tá»± thá»±c thi Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn blockchain, giÃºp tá»± Ä‘á»™ng hÃ³a vÃ  thá»±c thi cÃ¡c thá»a thuáº­n mÃ  khÃ´ng cáº§n bÃªn trung gian.

ğŸ”§ **Chá»©c nÄƒng chÃ­nh cá»§a smart contracts trong DeFi**:

- Trao Ä‘á»•i vÃ  hoÃ¡n Ä‘á»•i tÃ i sáº£n (Asset exchanges & swaps)
- CÆ¡ cháº¿ cho vay vÃ  Ä‘i vay (Lending & Borrowing)
- TÃ­nh toÃ¡n vÃ  phÃ¢n phá»‘i lÃ£i suáº¥t (Interest rate calculations & distributions)
- Quáº£n lÃ½ tÃ i sáº£n tháº¿ cháº¥p vÃ  thanh lÃ½ (Collateral management & liquidations)
- Táº¡o vÃ  Ä‘á»‘t token (Token minting & burning)
- Thá»±c hiá»‡n quy trÃ¬nh quáº£n trá»‹ (Governance processes)

---

### ğŸ’  Tokens (CÃ¡c loáº¡i token trong DeFi)

DeFi sá»­ dá»¥ng nhiá»u loáº¡i token Ä‘á»ƒ Ä‘áº¡i diá»‡n cho tÃ i sáº£n vÃ  phÃ¢n quyá»n Ä‘iá»u hÃ nh:

#### 1. Fungible Tokens (ERC-20) â€“ Token cÃ³ thá»ƒ thay tháº¿
- Dá»… trao Ä‘á»•i
- VÃ­ dá»¥: USDC, DAI, ETH, cÃ¡c token hÃ³a tÃ i sáº£n (tokenized assets)

#### 2. Non-Fungible Tokens (ERC-721) â€“ Token khÃ´ng thá»ƒ thay tháº¿
- Äáº¡i diá»‡n cho tÃ i sáº£n sá»‘ duy nháº¥t
- VÃ­ dá»¥: NFTs

#### 3. Liquidity Pool Tokens â€“ Token Ä‘áº¡i diá»‡n thanh khoáº£n
- Äáº¡i diá»‡n cho pháº§n Ä‘Ã³ng gÃ³p cá»§a ngÆ°á»i dÃ¹ng vÃ o pool thanh khoáº£n (trading pool)
- NgÆ°á»i dÃ¹ng kiáº¿m phÃ­ giao dá»‹ch thÃ´ng qua sá»Ÿ há»¯u token nÃ y
- VÃ­ dá»¥: Uniswap LP tokens, Curve LP tokens

#### 4. Governance Tokens â€“ Token quáº£n trá»‹
- Cho phÃ©p chá»§ sá»Ÿ há»¯u **biá»ƒu quyáº¿t cÃ¡c thay Ä‘á»•i trong giao thá»©c**
- VÃ­ dá»¥:
    - **AAVE** â€“ dÃ¹ng trong quáº£n trá»‹ cá»§a Aave
    - **UNI** â€“ dÃ¹ng trong quáº£n trá»‹ cá»§a Uniswap

#### 5. Wrapped Tokens â€“ Token Ä‘Æ°á»£c "bá»c"
- Äáº¡i diá»‡n cho tÃ i sáº£n tá»« chain khÃ¡c Ä‘Æ°á»£c Ä‘Æ°a sang
- VÃ­ dá»¥: **wBTC** â€“ Ä‘áº¡i diá»‡n cho Bitcoin trÃªn máº¡ng Ethereum

---

---

## ğŸ’¼ Common DeFi Services

### ğŸ” Decentralized Exchanges (DEXs)

DEX lÃ  cÃ¡c giao thá»©c cho phÃ©p giao dá»‹ch tiá»n mÃ£ hÃ³a **trá»±c tiáº¿p giá»¯a ngÆ°á»i dÃ¹ng** mÃ  khÃ´ng cáº§n bÃªn trung gian. CÃ¡c giao thá»©c nÃ y sá»­ dá»¥ng **smart contract** Ä‘á»ƒ:

- Tá»± Ä‘á»™ng thá»±c hiá»‡n giao dá»‹ch
- Quáº£n lÃ½ pool thanh khoáº£n
- KhÃ´ng yÃªu cáº§u bÃªn thá»© ba náº¯m giá»¯ tÃ i sáº£n cá»§a ngÆ°á»i dÃ¹ng

âš™ï¸ CÃ¡c tÃ­nh nÄƒng chÃ­nh cá»§a DEX:

- Sá»­ dá»¥ng cÆ¡ cháº¿ **Automated Market Maker (AMM)** Ä‘á»ƒ Ä‘á»‹nh giÃ¡ tÃ i sáº£n
- NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ cung cáº¥p thanh khoáº£n vÃ  nháº­n phÃ­ giao dá»‹ch
- Há»— trá»£ cÃ¡c tÃ­nh nÄƒng nÃ¢ng cao nhÆ° **limit orders**
- Dá»… dÃ ng tÃ­ch há»£p vá»›i cÃ¡c giao thá»©c DeFi khÃ¡c

---

### ğŸ“¥ Staking vÃ  Liquid Staking

Staking lÃ  hÃ nh Ä‘á»™ng **khÃ³a token** trong cÃ¡c máº¡ng **Proof-of-Stake (PoS)** Ä‘á»ƒ:

- Báº£o vá»‡ máº¡ng lÆ°á»›i
- GÃ³p pháº§n vÃ o quÃ¡ trÃ¬nh xÃ¡c thá»±c giao dá»‹ch
- Nháº­n pháº§n thÆ°á»Ÿng staking

#### Traditional Staking (Staking truyá»n thá»‘ng)

- Tá»± váº­n hÃ nh node validator, hoáº·c **á»§y quyá»n (delegate)** token cho validator khÃ¡c
- Token bá»‹ khÃ³a, **khÃ´ng thá»ƒ sá»­ dá»¥ng cho Ä‘áº¿n khi unstake**
- Sau khi unstake, cÃ³ thá»ƒ pháº£i chá» **thá»i gian unbonding** (phá»¥ thuá»™c máº¡ng)

#### ğŸ’§ Liquid Staking (Staking thanh khoáº£n)

- Stake token thÃ´ng qua **giao thá»©c liquid staking** (vÃ­ dá»¥: Lido)
- Nháº­n token Ä‘áº¡i diá»‡n (vÃ­ dá»¥: **stETH**) â†’ cÃ³ thá»ƒ sá»­ dá»¥ng trong cÃ¡c giao thá»©c DeFi khÃ¡c
- Token gá»‘c váº«n Ä‘Æ°á»£c stake â†’ **váº«n nháº­n pháº§n thÆ°á»Ÿng staking**
- CÃ³ thá»ƒ sá»­ dá»¥ng **stETH** Ä‘á»ƒ giao dá»‹ch, cung cáº¥p thanh khoáº£n, hoáº·c tháº¿ cháº¥p

ğŸ“Œ *Sá»± khÃ¡c biá»‡t chÃ­nh*:

| Traditional Staking | Liquid Staking |
|---------------------|----------------|
| Token bá»‹ khÃ³a hoÃ n toÃ n | Token váº«n Ä‘Æ°á»£c Ä‘áº¡i diá»‡n bá»Ÿi token thanh khoáº£n |
| KhÃ´ng thá»ƒ sá»­ dá»¥ng token khi Ä‘ang stake | CÃ³ thá»ƒ sá»­ dá»¥ng token Ä‘áº¡i diá»‡n trong DeFi |
| Pháº£i Ä‘á»£i unbonding Ä‘á»ƒ sá»­ dá»¥ng láº¡i | CÃ³ thanh khoáº£n ngay láº­p tá»©c qua token Ä‘áº¡i diá»‡n |

---

### âš™ï¸ Automated Market Makers (AMMs)

AMM lÃ  cÃ¡c smart contract tá»± Ä‘á»™ng thá»±c hiá»‡n giao dá»‹ch vÃ  quáº£n lÃ½ pool thanh khoáº£n trong DEXs.

ğŸ‘¥ NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ:

- Cung cáº¥p thanh khoáº£n cho pool vÃ  **nháº­n phÃ­ giao dá»‹ch**
- Nháº­n thÃªm token khuyáº¿n khÃ­ch tá»« giao thá»©c
- Káº¿t há»£p vá»›i staking token Ä‘á»ƒ **tÄƒng lá»£i nhuáº­n** (vÃ­ dá»¥: dÃ¹ng stETH trong pool AMM)

---

### ğŸ’¸ Lending & Borrowing (Cho vay vÃ  Ä‘i vay)

CÃ¡c giao thá»©c lending DeFi cho phÃ©p **cho vay â€“ vay mÆ°á»£n tÃ i sáº£n ngang hÃ ng (peer-to-peer)** thÃ´ng qua smart contracts.

ğŸ“Š NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ:

- Cho vay tÃ i sáº£n Ä‘á»ƒ **nháº­n lÃ£i suáº¥t**
- Vay tÃ i sáº£n báº±ng cÃ¡ch **cung cáº¥p tÃ i sáº£n tháº¿ cháº¥p**
- Tá»± Ä‘iá»u chá»‰nh vá»‹ tháº¿ theo Ä‘iá»u kiá»‡n thá»‹ trÆ°á»ng
- Sá»­ dá»¥ng **flash loans** â€“ khoáº£n vay khÃ´ng cáº§n tháº¿ cháº¥p trong má»™t giao dá»‹ch duy nháº¥t
- Tiáº¿p cáº­n **Ä‘Ã²n báº©y tÃ i chÃ­nh** thÃ´ng qua cÃ¡c thá»‹ trÆ°á»ng lending

ğŸ’¡ VÃ­ dá»¥: TrÃªn Aave, ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ:
- Cho vay ETH Ä‘á»ƒ nháº­n lÃ£i
- Vay USDC báº±ng cÃ¡ch tháº¿ cháº¥p ETH

---
## CÃ i Ä‘áº·t

CÃ i Ä‘áº·t OpenZeppelin dependencies dÃ¹ng Foundry:
```bash
forge install OpenZeppelin/openzeppelin-contracts --no-commit
```

Generate remapping:
```bash
forge remappings > remappings.txt
```

---
## âš ï¸ Errors

### Overriding function visibility differs
Lá»—i nÃ y xáº£y ra khi **visibility** cá»§a hÃ m trong contract con khÃ´ng khá»›p vá»›i **visibility** cá»§a hÃ m trong contract cha khi Ä‘ang ghi Ä‘Ã¨.

ğŸ› ï¸ Solution: 
> Äáº£m báº£o ráº±ng hÃ m ghi Ä‘Ã¨ cÃ³ cÃ¹ng **visibility** nhÆ° hÃ m trong contract cha.
